\documentclass[12pt,a4paper,english]{book}
\usepackage{color}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{fancyhdr}
\usepackage{listings}

\pagestyle{fancy}
\fancyhead{}
\fancyfoot{}
\fancyhead[LE,RO]{\slshape \rightmark}
\fancyhead[LO,RE]{\slshape \leftmark}
\fancyfoot[C]{\thepage}

\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

\definecolor{darkgray}{rgb}{0.47,0.79,0.47}

\hypersetup{
  colorlinks = true,
  linkcolor=blue,   % color of internal links
  citecolor=blue,   % color of links to bibliography
  urlcolor=blue,    % color of external links
  pagebackref=true,
  implicit=false,
  bookmarks=true,
  bookmarksopen=true,
  pdfdisplaydoctitle=true
}
\begin{document}
\lstset{ %
language=Octave,                % choose the language of the code
basicstyle=\footnotesize,      % the size of the fonts that are used for the code
numbers=left,                   % where to put the line-numbers
numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
stepnumber=0,                   % the step between two line-numbers. If it's 1 each line
                                % will be numbered
numbersep=5pt,                  % how far the line-numbers are from the code
backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
showspaces=false,               % show spaces adding particular underscores
showstringspaces=false,         % underline spaces within strings
showtabs=false,                 % show tabs within strings adding particular underscores
frame=tb, 
tabsize=2,	                % sets default tabsize to 2 spaces
captionpos=b,                   % sets the caption-position to bottom
breaklines=true,                % sets automatic line breaking
breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
title=\lstname,                 % show the filename of files included with \lstinputlisting;
                                % also try caption instead of title
escapeinside={\%*}{*)},         % if you want to add a comment within your code
morekeywords={*,...},            % if you want to add more keywords to the set
keywordstyle={\color{blue}},
commentstyle={\color{darkgray}},
stringstyle={\color{red}},
framexleftmargin=3pt,
framexrightmargin=3pt,
framextopmargin=3pt,
framexbottommargin=3pt
}

\title{The oark book \href{http://code.google.com/p/oark/}{http://code.google.com/p/oark/} \newline\begin{figure} [h]
\begin {center}
\includegraphics[width=0.2\textwidth]{oark.jpg}
\end {center}
\end{figure} \newline The Open Source Anti Rootkit}
\author{David Reguera Garcia aka Dreg - Dreg@fr33project.org}
\maketitle
\date{}
\tableofcontents

\chapter{Introduction}
This chapter's content..


\lstset{language=C,caption=Descriptive Caption Text,label=DescriptiveLabels}
\begin{lstlisting}
/* Copyright Dreg aka David Reguera Garcia dreg@fr33project.org
Permission is hereby granted, free of charge,  */

#include "driverusr.h"

void * IOCTLReadKernMem( HANDLE device, READ_KERN_MEM_t * read_kern_mem )
{
        ULONG bytes_read ;
        bytes_read = 0 ;

        if
        (
                DeviceIoControl
                (
                        device,
                        OARK_IOCTL_CHANGE_MODE,
                        read_kern_mem,
                        sizeof( * read_kern_mem ),
                        NULL,
                        "chuuuuu",
                        & bytes_read,
                        ( LPOVERLAPPED) NULL
                )
        )
                return read_kern_mem->dst_address;

        return NULL;
}


\end{lstlisting}


\section{sub Introduction}
This section's content...

\subsection{sub sub Introduction}
This subsection's content..

\chapter{Other chapter}
This chapter's content..
Biblio reference: \cite{Erdos01}

\begin{thebibliography}{9}

\addcontentsline{toc}{chapter}{Bibliography}

\bibitem{Erdos01} P. Erd\H os, \emph{A selection of problems and
results in combinatorics}, Recent trends in combinatorics (Matrahaza,
1995), Cambridge Univ. Press, Cambridge, 2001, pp. 1--6.

\bibitem{ConcreteMath}
R.L. Graham, D.E. Knuth, and O. Patashnik, \emph{Concrete
mathematics}, Addison-Wesley, Reading, MA, 1989.

\bibitem{Knuth92} D.E. Knuth, \emph{Two notes on notation}, Amer.
Math. Monthly \textbf{99} (1992), 403--422.

\bibitem{Simpson} H. Simpson, \emph{Proof of the Riemann
Hypothesis},  preprint (2003), available at
\url{http://www.math.drofnats.edu/riemann.ps}.

\end{thebibliography}

\end{document}

























